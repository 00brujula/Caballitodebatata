<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Caballito de Batata - Player</title>

<style>
body{
  background:#0d001a;
  font-family: monospace;
  color:#d8b4ff;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
  margin:0;
}

.player{
  background:#1a0033;
  border:3px solid #a855f7;
  box-shadow:0 0 20px #7e22ce;
  padding:20px;
  width:320px;
}

h1{
  font-size:16px;
  text-align:center;
  color:#c084fc;
  margin-bottom:15px;
}

button{
  width:100%;
  padding:10px;
  background:#7e22ce;
  border:none;
  color:white;
  font-weight:bold;
  cursor:pointer;
  margin-bottom:10px;
}

button:hover{
  background:#a855f7;
}

select{
  width:100%;
  margin-bottom:10px;
  background:#2e1065;
  color:white;
  border:none;
  padding:5px;
}

canvas{
  width:100%;
  height:60px;
  background:#0d001a;
  margin-top:10px;
}

.volume{
  width:100%;
}
</style>
</head>

<body>

<div class="player">
  <h1>Caballito de Batata</h1>

  <select id="trackSelect">
    <option value="https://archive.org/download/viajedelheroe0/5feb.mp3">Capítulo 0 (El loco)</option>
    <option value="https://archive.org/download/Viajedelheroecap1/capitulo1.mp3">Capítulo 1 (El mago)</option>
    <option value="https://archive.org/download/viajedelheroe0/eternoartista.mp3">El eterno artista - Noche Magnetik</option>
    <option value="https://archive.org/download/viajedelheroe0/mirandolasnubes.mp3">Mirando las nubes - Noche Magnetik</option>    

  </select>

  <button onclick="togglePlay()">PLAY / PAUSE</button>

  <input class="volume" type="range" min="0" max="1" step="0.01" value="1" onchange="setVolume(this.value)">

  <canvas id="visualizer"></canvas>

  <audio id="audio" crossorigin="anonymous"></audio>
</div>

<script>
const audio = document.getElementById("audio");
const select = document.getElementById("trackSelect");

audio.src = select.value;

select.addEventListener("change", () => {
  audio.src = select.value;
  audio.play().catch(()=>{});
});

function togglePlay(){
  if(audio.paused){
    audio.play().catch(()=>alert("No se pudo reproducir el audio."));
  } else {
    audio.pause();
  }
}

function setVolume(val){
  audio.volume = val;
}

/* Visualizador simple 8bit */
const canvas = document.getElementById("visualizer");
const ctx = canvas.getContext("2d");

const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
const analyser = audioCtx.createAnalyser();
const source = audioCtx.createMediaElementSource(audio);

source.connect(analyser);
analyser.connect(audioCtx.destination);

analyser.fftSize = 64;
const bufferLength = analyser.frequencyBinCount;
const dataArray = new Uint8Array(bufferLength);

function draw(){
  requestAnimationFrame(draw);
  analyser.getByteFrequencyData(dataArray);

  ctx.fillStyle = "#0d001a";
  ctx.fillRect(0,0,canvas.width,canvas.height);

  const barWidth = canvas.width / bufferLength;

  for(let i=0;i<bufferLength;i++){
    const barHeight = dataArray[i] / 3;
    ctx.fillStyle = "#a855f7";
    ctx.fillRect(i*barWidth, canvas.height - barHeight, barWidth - 2, barHeight);
  }
}

draw();
</script>

</body>
</html>
